<div id="lp-pop">
    <div class="submenu">
        <div class="content">
            <nav>
                <ul>
                    <li>
                        <a href="" data-tracking-label="Menu - Size"></a>
                    </li>
                    <li>
                        <a href="" data-tracking-label="Menu - Colour"></a>
                    </li>
                    <li>
                        <a href="" data-tracking-label="Menu - Cup Sizes"></a>
                    </li>
                    <li>
                        <div class="btn shop-now-btn" data-tracking-label="Menu - Shop">
                            <span></span>
                        </div>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <section class="hero" data-color="blue">
        <div class="content">
            <h1></h1>
        </div>
        <img src="https://www.nespresso.com/ecom/medias/sys_master/public/26787710042142/poster-blue.png" class="machine-poster" alt="Vertuo Pop + machine poster" />
    </section>

    <section class="wrap">
        <div class="sticky-container">
            <div id="custom3DViewerContainer">
                    <div class="comparaison">
                        <div class="cup-size">
                                <img src="https://www.nespresso.com/ecom/medias/sys_master/public/26787710042142/poster-blue.png" class="machine-poster" alt="Vertuo Pop + machine poster" />
                                <img class="cup-size-img" />
                                <p class="cup-size-info"></p>
                                <img class="milk-pint" />
                        </div>
                        <span class="info pop-info"></span>
                        <span class="info milk-info"></span>
                        <ul id="colorContainer"></ul>
                    </div>
            </div>
        </div>      
        <div class="headings">
            <h2 class="first" id="size"></h2>
            &nbsp;
            <h2 class="second" id="colour"></h2>
            &nbsp;
            <h2 class="third" id="cup-sizes"></h2>
            &nbsp;
        </div>
        <div class="bg-bottom"></div>
    </section>

    <div class="swiper">
        <div class="machine-range"></div>
        <div class="prev-btn">
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25">
                    <path d="M15.207 5.356h-1.414l-7 7 7 7h1.414l-7-7 7-7Z"></path>
                </svg>
            </div>
        </div>
        <div class="next-btn">
            <div>   
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25">
                    <path d="M10.207 5.356H8.793l7 7-7 7h1.414l7-7-7-7Z"></path>
                </svg>
            </div>
        </div>
    </div>
</div>
<style>

* {
    box-sizing: border-box;
}

@media screen and (min-width:1200px) {
    .swiper,
    .machine-range {
        overflow: visible !important;
    }
}

@media screen and (min-width:996px) and (max-width:1199px){
    .machine-range {
        padding-top: 100px;
    }
}


@media screen and (max-width:995px) {
    body.has-overlay-absolute .swiper,
    body.has-overlay-absolute .machine-range,
    body.has-overlay .swiper,
    body.has-overlay .machine-range {
        overflow: visible !important;
    }

    body.has-overlay-absolute .machine-range .machine-item,
	body.has-overlay-absolute .machine-range,
	body.has-overlay .machine-range .machine-item,
	body.has-overlay .machine-range {
		transform: none !important;
	}
}

#main .AddToBagButtonSmall {
	border-radius:50%;
}

body {
    margin: 0;
    font-family: "Nespresso Lucas",  "NespressoLucas", 'Lucas';
    font-weight: 700;
    position: relative;
    width: 100%;
    height: 100%;
}

#lp-pop h2 {
    margin: auto;
    margin-top: 60vw;
    opacity: 0;
    transform: translateY(100px);
    transition: opacity 1s ease-in, transform 0.7s ease-in;
    font-size: 40px;
    width: 450px;
    margin-left: 0;
    text-transform: uppercase;
    line-height: 1.25em;
}

#lp-pop h2:first-child {
    margin-top: 60vh;
}

#lp-pop h2:last-child {
    margin-bottom: 50vh;
}

#lp-pop .btn {
    position: relative;
    height: 40px;
    width: 180px;
    /* margin-left: 1rem; */
    text-transform: uppercase;
    font-weight: 400;
}

[lang="fr"] #lp-pop .btn {
    width: 200px;
}


#lp-pop .btn::after {
    content: "";
    background-color: black;
    color: white;
    border-radius: 48px;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
    height: 100%;
    width: 100%;
    cursor: pointer;
    display: inline-block;
}

#lp-pop .btn span {
    z-index: 20;
    color: white;
    position: absolute;
    left: 50%;
    transform: translate(-50%, 0);
    width: 180px;
    line-height: 40px;
    cursor: pointer;
    font-size: 14px;
    text-align: center;
}

#lp-pop [lang="fr"] .btn span {
    width: 230px;
}

#lp-pop .btn::after {
    transition: all 0.3s cubic-bezier(.1,.75,.3,1);
}

#lp-pop .btn:hover::after {
    -webkit-transform: scaleX(1.10);
	-moz-transform: scaleX(1.10);
	-ms-transform: scaleX(1.10);
	transform: scaleX(1.10);
    box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
}

/* 
    ===============
        SUBMENU  
    =============== 
*/
#lp-pop .submenu {
    width: 100%;
    text-transform: uppercase;
    font-weight: 400;
    letter-spacing: 0.25px;
    padding: 0 88px;
    background-color: rgba(255, 255, 255, 1);
    z-index: 200;
    top: 80px;
    height: 60px;
    box-shadow: 0 0 6px rgb(23 23 26 / 15%), 0 6px 16px rgb(23 23 26 / 14%);
    position: sticky;
    transition: all 0.7s ease;
}

#lp-pop .submenu .content {
    max-width: 996px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: end;
    height: 100%;
}

#lp-pop .submenu p {
    display: none;
}

#lp-pop .submenu nav {
    display: flex;
    height: 100%;
    padding-right: 0.15rem;
}

#lp-pop .submenu ul {
    list-style: none;
    display: flex;
    gap: 1.5rem;
    align-items: center;
    padding-left: 0;
}

#lp-pop .submenu a {
    text-decoration: none;
    color: black;
    font-size: 14px;
}

/* 
    ===============
        HERO  
    =============== 
*/
#lp-pop .hero {
    display: flex;
    justify-content: center;
    align-items: center;
    max-width: 100%;
    margin: auto;
    text-align: start;
    background: no-repeat url('https://www.nespresso.com/ecom/medias/sys_master/public/26769602707486/VertuoPop-PDPBackground-Desktop-Blue.jpg') center/cover;
    background-attachment: fixed;
    height: 500px;
    transition: all 0.3s ease;
    z-index: 2;
}

#lp-pop .hero .content {
    max-width: 1200px;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: start;
    justify-content: start;
    padding-left: 6rem;
    text-align: start;
    gap: 1.5rem;
    animation: 1s slide-left ease;
    overflow: visible;
}

#lp-pop .hero h1 {
    text-transform: uppercase;
    font-size: 48px;
    letter-spacing: 4px;
    margin: 0;
    line-height: 1.3em;
}

#lp-pop .hero p {
    font-weight: 400;
    font-size: 20px;
    color: #17171a;
    line-height: 120%;
    margin: 0;
}

#lp-pop .hero p:first-child {
    text-transform: uppercase;
    font-weight: 700;
    letter-spacing: 0.12em;
    margin-bottom: 0.5rem;
}

/* 
    =================
        GRADIENTS  
    =================
*/
.hero[data-color="blue"] h1 span.gradient,
.gradient.blue {
    background: linear-gradient(80.76deg, #7DA5D8 22.86%, #7DA5D8 40.51%, #283593 66.52%, #E7454B 77.34%);
}

.hero[data-color="aqua"] h1 span.gradient,
.gradient.aqua {
    background: linear-gradient(90.3deg, #7DA5D8 -2.82%, #84CABF -1.52%, #257A57 36.83%);
}

.hero[data-color="red"] h1 span.gradient,
.gradient.red {
    background: linear-gradient(90.24deg, #E7454B 7.14%, #ED6943 70.13%, #FAB931 105.8%);
}

.hero[data-color="yellow"] h1 span.gradient,
.gradient.yellow {
    background: linear-gradient(89.95deg, #ED6943 -4.52%, #FAB931 23.82%);
}

.hero[data-color="grey"] h1 span.gradient,
.gradient.grey {
    background: linear-gradient(to right, rgba(0,0,0,0.6) 0%, #979797 100%);
}

.hero[data-color="black"] h1 span.gradient,
.gradient.black {
    background: linear-gradient(to right, #000 0%, #d8d8d8 100%);
}

span.gradient {
    -webkit-background-clip: text !important;
    -moz-background-clip: text !important;
    -webkit-text-fill-color: transparent;
    background-clip: text !important;
    color: transparent !important;
    font-family: 'Nespresso Lucas', 'NespressoLucas';
    font-weight: 700;
    text-decoration: none;
    text-transform: uppercase;
    display: inline-block;
    position: relative;
    mask-image: linear-gradient(-44deg, #E7454B 30%, #000 50%, rgba(0,0,0,.6) 70%);
    -webkit-mask-image: linear-gradient(-44deg, #E7454B 30%, #000 50%, rgba(0,0,0,.6) 70%);
    animation: shine 3s linear infinite;
    mask-size: 200%;
    -webkit-mask-size: 200%;
}

h2 span.gradient {
    background: conic-gradient(from 74.83deg at 36.04% 100%, #84CABF -8.81deg, #7DA5D8 25.45deg, #E7454B 163.25deg, #ED6943 201.41deg, #FAB931 244.2deg, #84CABF 351.19deg, #7DA5D8 385.45deg);
}

/* 
    =================
        3D MODEL  
    =================
*/
.machine-poster {
    display: none;
}

#lp-pop #custom3DViewerContainer {
    position: absolute;
    width: 600px;
    height: 1200px;
    top: -700px;
    left: -20%;
    right: 0;
}

#lp-pop model-viewer {
    width: 100%;
    height: 500px;
    --progress-bar-color: transparent;
    transform: translateY(0);
    position: absolute;
    top: 0;
    right: 0;
    z-index: 1;
    transition: all 0.1s ease;
    cursor: pointer;
}

#lp-pop #custom3DViewerContainer {
    left: -30%;
}

#lp-pop .wrap {
    /* min-height: 3000px; */
    display: flex;
    flex-direction: row-reverse;
    justify-content: space-between;
    /* padding-right: 10%;
    padding-left: 15%; */
    margin: 400px auto 200px auto;
    position: relative;
    max-width: 1000px;
    gap: 4rem;
}

/* 
    ======================
        STICKY CONTAINER  
    ======================
*/
#lp-pop .sticky-container {
    position: sticky;
    top: 50%;
    transform: translateY(-50%);
    width: 600px;
    height: 400px;
    z-index: 10;
}

/* 
    ==================================
        FIRST SECTION - COMPARAISON  
    ==================================
*/
.wrap .comparaison {
    display: flex;
    width: 500px;
    height: 500px;
    position: absolute;
    bottom: 0;
    right: 1%;
    z-index: 200;
    cursor: pointer;
}

.wrap .comparaison .info {
    position: absolute;
    z-index: -1;
    font-weight: 300;
    display: flex;
    align-items: center;
    font-weight: 300;
    visibility: none;
    opacity: 0;
    font-size: 14px;
    text-align: center;
    line-height: 120%;
    letter-spacing: 4px;
    transition: all 0.3s ease;
}

body[data-heading='first'] .wrap .comparaison .info {
    visibility: visible;
    opacity: 1;
}

.milk-info {
    top: 15%;
    z-index: 200;
}

.milk-info::after {
    width: 284px !important;
    top: 0%;
}

.milk-info::before {
    content: '';
    position: absolute;
    right: 0;
    top: 8px;
    display: inline-block;
    margin-left: 5px;
    border: none;
    border-right: 1px dotted #000;
    color: #fff;
    background-color: #fff;
    height: 40px;
    width: 1px;
}

.pop-info {
    top: 30%;
    z-index: 200;
    left: -3.5%;
}

span.info::after {
    content: "";
    /* display: inlineock; */
    margin-left: 5px;
    border: none;
    border-top: 1px dotted #000;
    color: #fff;
    background-color: #fff;
    height: 1px;
    width: 48px;
    z-index: -1;
}

#lp-pop .wrap .comparaison .milk-pint {
    position: absolute;
    width: 430px;
    height: auto;
    object-fit: cover;
    visibility: hidden;
    opacity: 0;
    transition: all 0.3s ease;
    left: 16%;
    top: -5%;
}

body[data-heading="first"] #lp-pop .wrap .comparaison .milk-pint {
    visibility: visible;
    opacity: 1;
}

/* 
    =====================================
        SECOND SECTION - COLOR PICKER 
    =====================================
*/
.floating {
    animation: floating 3s infinite ease-in-out;
}

#colorContainer {
    text-align: center;
    display:flex;
    justify-content: center;
    z-index: 3;
    visibility: hidden;
    transform: scale(0);
    height: 100%;
    left: -5%;
    border-radius: 50%;
    width: 100%;
    position: relative;
    max-width: 100vw;
    z-index: 800;
}

body[data-heading="second"] #colorContainer {
    visibility: visible;
    transform: scale(1);
    transition: all 0.6s ease 0.2s;
}

#colorContainer li {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: block;
    margin: 0 10px;
    border: 2px solid ccc;
    cursor: pointer;
}

.color {
    border-radius: 50%;
    position: absolute;
    left: 0;
    box-shadow: 0 0 0 1px rgba(149, 157, 165, 0.02);
    cursor: pointer;
    transition: all 0.4s ease;
    align-items: center;
    z-index: 800 !important;
}

.color:hover::after,
.color.active::after {
    content: ""; 
    border: 1px solid #8b8b8c;
    width: 106%;
    height: 106%;
    border-radius: 50%;
    display: inline-block;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    position: absolute;
}

.color:first-child {
    left: 25%;
    top: 0;
    background-color: #6097de;
    animation: floating 4s infinite;
}

.color:nth-child(2) {
    top: 15%;
    left: 6%;
    background-color: #41ddc8;
    animation: floatingReverse 6s infinite;
}

.color:nth-child(3) {
    top: 36%;
    left: -3%;
    background-color: #cf1f2a;
    animation: floating 4s infinite;
}

.color:nth-child(4) {
    top: 58%;
    left: -3%;
    background-color: #ea9503;
    animation: floatingReverse 6s infinite;
}

.color:nth-child(5) {
    top: 75%;
    left: 5%;
    background-color: #c5c5c5;
    animation: floating 4s infinite;
}

.color:nth-child(6) {
    top: 90%;
    left: 23%;
    background-color: #000;
    animation: floatingReverse 6s infinite;
}

/* 
    =======================================
        THIRD SECTION - CUP SIZE SECTION
    =======================================
*/
.cup-size {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: absolute;
    /* top: 0; */
    bottom: 0;
    width: 100%;
    height: 100%;
    font-weight: 400;
    z-index: 2;
}

.cup-size-img {
    width: 225px;
    height: auto;
    position: absolute;
    bottom: 20.5%;
    left: 29.5%;
    visibility: hidden;
    opacity: 0;
}

body[data-heading="third"] .cup-size-img {
    visibility: visible;
    opacity: 1;
    transition: all 0.4s ease 0.2s;
}

.cup-size-info {
    position: absolute;
    visibility: hidden;
    opacity: 0;
    bottom: 3%;
    left: 21.5%;
    font-weight: 400;
    text-align: center;
    font-size: 24px;
    margin: 0.2rem;
    width: 300px;
    letter-spacing: 1px;
    line-height: 1.2em;
}

body[data-heading="third"] .cup-size-info {
    visibility: visible;
    opacity: 1;
    transition: all 0.4s ease 0.2s;
}


/* 
    ==============================
            MACHINE RANGE
    ============================== 
*/
.machine-range {
    display: flex;
    justify-content: center;
    text-align: center;
    overflow-y: hidden;
    overflow-x:hidden;
    position: relative;
    /* transition: transform 0.3s ease; */
    transition: transform 0.4s;
    transition-timing-function: cubic-bezier(0,0,.2,1);
}

.swiper {
    height: 570px;
    width: 100%;
    overflow: hidden;
    position: relative;
}

.prev-btn,
.next-btn {
    border-radius: 50%;
    background-color: black;
    height: 50px;
    width: 50px;
    min-height: 50px;
    min-width: 50px;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    z-index: 400;
    display: none;
    background-color: white;
    border: 1px solid black;
}

.prev-btn {
    left: 0;
}

.next-btn {
    right: 0;
}

.prev-btn div,
.next-btn div {
    width: 100%;
    height: 100%;
    position: relative;
}

.prev-btn svg,
.next-btn svg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.machine-range .machine-item {
    cursor: pointer;
    transform: translateY(600px);
}

.machine-range .machine-item .name {
    text-transform: uppercase;
    font-weight: 700;
    letter-spacing: 1.25px;
    line-height: 22px;
    min-height: 68px;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.machine-range .machine-item .coming-soon {
    margin-top: 24px;
    height: 24px;
    opacity: 0.5;
    font-weight: 300;
    font-size: 16px;
}

.machine-range .machine-item .price {
    font-weight: 400;
    font-size: 16px;
    margin: 1rem 0;
}

.machine-item:first-child .name {
    color: #80A8D9;
}

.machine-item:nth-child(2) .name {
    color: #7FC8BC;
}

.machine-item:nth-child(3) .name {
    color: #E12A2E;
}

.machine-item:nth-child(4) .name {
    color: #F5A320;
}

.machine-item:nth-child(5) .name {
    color: #B1B1B1;
}

.machine-item:nth-child(6) .name {
    color: #000;
}

.machine-range img {
    width: 200px;
}

.machine-item.animate-in:first-child {
    transition: transform 0.3s ease;
    transform: translateY(0);
}

.machine-item.animate-in:nth-child(2) {
    transition: transform 0.3s ease 0.1s;
    transform: translateY(0);
}

.machine-item.animate-in:nth-child(3) {
    transition: transform 0.3s ease 0.2s;
    transform: translateY(0);
}

.machine-item.animate-in:nth-child(4) {
    transition: transform 0.3s ease 0.3s;
    transform: translateY(0);
}

.machine-item.animate-in:nth-child(5) {
    transition: transform 0.3s ease 0.4s;
    transform: translateY(0);
}

.machine-item.animate-in:nth-child(6) {
    transition: transform 0.3s ease 0.5s;
    transform: translateY(0);
}

.machine-item.animate-out {
    transition: transform 0.3s ease 0.5s;
    transform: translateY(600px);
}

/* 
    ==============================
            MEDIA QUERIES 
    ============================== 
*/
@media (min-width: 2500px) {
    #lp-pop .hero .content {
        padding-left: 8rem;
    }
}

@media (max-width: 1350px) {
    #lp-pop .wrap {
        gap: 0;
    }

    #lp-pop #custom3DViewerContainer {
        left: auto;
    }

    #colorContainer {
        width: 380px;
        height: 380px;
        top: 50px;
    }

    .color {
        width: 50px;
        height: 50px;
    }

    .color.active,
    .color:hover {
        width: 52px;
        height: 52px;
    }

    #lp-pop h2 {
        padding-left: 0;
    }
}

@media (max-width: 1200px) {
    /*s machine range carousel */
    .machine-range {
        position: absolute;
    }

    .machine-range .machine-item {
        transform: translateY(0);
    }

    .next-btn {
        display: block;
    }
}

@media (max-width: 996px) {
    #lp-pop #custom3DViewerContainer {
        left: auto;
    }

    .cup-size-img {
        left: 25%;
    }

    .cup-size-info {
        left: 17%;
    }

    .wrap .comparaison {
        right: auto;
        left: 70%;
        transform: translateX(-50vw);
    }

    #lp-pop .wrap {
        padding: 2rem;
    }

    #lp-pop .wrap .bg-bottom {
        position: fixed;
        bottom: 0;
        background: #faf9f8;
        background: linear-gradient(180deg, rgba(250,249,248,0) 0%, rgba(250,249,248,0.30) 10%, rgba(250,249,248,0.5) 15%, rgba(250,249,248,0.90) 20%, rgba(250,249,248,0.98) 40%, rgba(250,249,248,1) 100%);
        width: 100%;
        height: 50vh;
        z-index: 0;
    }

    #lp-pop .hero h1 {
        font-size: 32px;
    }

    #lp-pop h2 {
        width: 100%;
        margin-left: auto;
        margin-right: auto;
    }

    #lp-pop .btn {
        width: 150px;
    }

    #lp-pop .btn span {
        width: 150px;
    }


    #lp-pop .wrap {
        padding: 0;
    }

    #lp-pop .submenu {
        top: 50px;
    }

    #lp-pop .submenu .content {
        padding-right: 1rem;
    }

    #lp-pop .submenu ul {
        gap: 0.75rem;
        font-size: 14px;
    }

    [lang="fr"] #lp-pop .submenu ul {
        gap: 0.5rem;
    }

    #lp-pop .submenu a {
        font-size: 14px;
    }

    #lp-pop .hero {
        text-align: center;
        position: relative;
        align-items: start;
        height: 700px;
    }

    #lp-pop .hero .content {
        text-align: center;
        align-items: center;
        justify-content: end;
        margin: auto 0;
        animation: none;
        height: 100%;
        padding-left: 0;
        padding-bottom: 2rem;
    }

    #lp-pop .hero h1 {
        width: 100%;
        font-size: 32px;
    }

    html[lang="fr"] #lp-pop .hero h1 {
        font-size: 26px;
    }

    #lp-pop .btn {
        /* max-width: 140px; */
        margin-left: 0;
    }

    #lp-pop #custom3DViewerContainer {
        /* left: 50%;
        transform: translateX(-50%); */
        min-width: 100%;
        /* width: auto; */
        top: -1000px;
        height: 1300px;
    }

    #lp-pop model-viewer { 
        left: 50%;
        transform: translateX(-50vw);
    }

    #lp-pop .sticky-container {
        /* width: 100%; */
        bottom: 0;
        display: flex;
        justify-content: center;
        transform: translateY(-10%);
        /* transform: translateY(-10%); */
        width: auto;
        /* min-width: 300px; */
    }

    #lp-pop .wrap {
        gap: 0;
        position: relative;
    }

    span.info:nth-child(3)::after {
        width: auto;
    }

    .milk-info::before,
    span.info::after {
        display: none;
    }

    .wrap .comparaison .info {
        bottom:0;
        height: 30px;
    }

    .milk-info,
    .pop-info {
        top: auto;
    }

    .wrap .comparaison .milk-info {
        right: 8%;
    }

    .wrap .comparaison .pop-info {
        left: 37%;
    }

    .pop-info::after {
        left: 0;
    }

    /* #colorContainer {
        width: 150px;
    } */

    .machine-range .machine-item .price {
        margin: 0.15rem 0;
    }

    .machine-range .machine-item .coming-soon {
        margin-top: 10px;
    }

    .wrap .comparaison .info {
        z-index: 20;
    }

    .swiper {
        height: 450px;
    }

    .machine-range img {
        width: 150px;
    }

    #lp-pop .wrap {
        min-height: 3000px;

    }

    #lp-pop h2 {
        text-align: center;
    }

    #lp-pop #custom3DViewerContainer {
        /* left: 50%; */
        transform: translateX(-53%);
        right: auto;
    }

    #lp-pop h2 {
        width: 80%;
        margin-left: auto;
        margin-right: auto;
        max-width: none;
        text-align: center;
        padding-left: 0 !important;
        font-size: 28px;
    }

    html[lang="fr"] #lp-pop .submenu a,
    #lp-pop .btn span {
        font-size: 12px;
    }

    html[lang="fr"] #lp-pop .btn {
        width: 170px;
    }

    #colorContainer {
        left: -5vw;
    }

}

@media (max-width: 768px) {
    .wrap .comparaison {
        left: 60%;
    }

    #lp-pop .submenu {
        padding: 0;
    }

    #lp-hero h1 {
        font-size: 32px;
    }

    #lp-pop .headings {
        width: 100%;
        /* position: absolute; */
        /* z-index: -1; */
        text-align: center;
    }

    #lp-pop .sticky-container {
        z-index:2;
    }

    #lp-pop h2 {
        /* width: 100%; */
        padding-right: 0;
        padding-left: 10%;
        width: none;
        max-width: 45%;
        text-align: center;
        /* margin-left: auto;
        margin-right: auto; */
        padding-left: 10%;
        padding-top:20vh;
        padding-bottom:20vh;
        margin:30vh auto 50vh;
    }

    html[lang="fr"] #lp-pop h2 {
        font-size: 26px;
    }

    #lp-pop h2 {
        /* max-width: none;
        padding-right: 10%;
        padding-left: 10%; */
        font-size: 24px;
    }

    #lp-pop h2 + h2{
        margin-top: 60vh
    }

    #lp-pop .hero {
        height: 500px;
    }
    
    #lp-pop .wrap .comparaison .milk-pint {
        left: 0;
    }

    .cup-size-info { 
        font-size: 16px;
    }

    #lp-pop model-viewer {
        left: 70%;
        width: 350px;
        /* transform: translate(-15vw); */
    }

    #lp-pop .wrap .comparaison .milk-pint {
        width: 320px;
        left: auto;
        right: 0;
        top: auto;
        bottom: 5%;
    }

    #colorContainer {
        height: 280px;
        top: 20%;
        max-width: 50%;
        left: 10%;
    }

    .cup-size-img {
        width: 150px;
        bottom: 28%;
        left: 39%;
    }

    .cup-size-info {
        bottom: 15%;
        left: 25%;
    }

    .hero {
        height: 450px;
    }

    #lp-pop .submenu .content {
        padding-right: 0;
    }

    .wrap .comparaison .pop-info {
        left: 45%;
    }

    .wrap .comparaison .milk-info {
        right: 5%;
    }

    #colorContainer li {
        width: 40px;
        height: 40px;
    }

    #lp-pop h2:first-child {
        margin-top: 200px;
    }

    #lp-pop #custom3DViewerContainer {
        height: 1300px;
        top: -900px;
    }

    .wrap .comparaison .info {
        bottom: 15%;
        height: 30px;
    }

    #lp-pop h2 {
        width: 80%;
        margin-left: auto;
        margin-right: auto;
        max-width: none;
        text-align: center;
        padding-left: 0 !important;
    }

    html[lang="fr"] #lp-pop h2 {
        font-size: 24px;
    }
}



@media (max-width: 468px) {
    .wrap .comparaison .pop-info {
        left: 55%;
    }

    .wrap .comparaison {
        left: 55%;
        width: 80%;
    }

    .cup-size-img {
        left: 47%;
    }

    .cup-size-info {
        left: 47%;
    }

    .cup-size-info {
        left: 32%;
    }
    
    #lp-pop h2 {
        margin: auto;
        margin-top: 40vw;
    }

    #lp-pop h2:first-child {
        margin-top: 40vh;
    }

    #lp-pop h2:last-child {
        margin-bottom: 40vh;
    }

    #colorContainer {
        left: 18%;
    }
}

@media (max-width: 374px) {
    #lp-pop model-viewer {
        width: 300px;
    }

    #lp-pop .wrap .comparaison .milk-pint {
        width: 280px;
        bottom: 10%;
    }

    #colorContainer {
        left: 32%;
    }

    .wrap .comparaison {
        left: 47%;
    }

    .cup-size-img {
        left: 51%;
    }

    .cup-size-info {
        left: 35%;
    }
}

/* 
    ===============
        ANIMS  
    =============== 
*/
@keyframes shine {
    from { -webkit-mask-position: 150%; }
    to { -webkit-mask-position: -50%; }
}

@keyframes slide-left {
    from {
        margin-left: -100%;
        opacity: 0;
    }
    to {
        margin-left: 0%;
        opacity: 1;
    }
}

@keyframes floating {
    0% { transform: translate(0, 0px) }
    50% { transform:translate(0,5px) }
    100% { transform: translate(0, -0px) }
}

@keyframes floatingReverse {
    0% { transform: translate(0, -0px) }
    50% { transform:translate(0,-5px) }
    100% { transform: translate(0, 0px) }
}

/* 
    ==============================
        PREFERS REDUCED MOTION  
    ==============================
*/
@media (prefers-reduced-motion: reduce) {
    #lp-pop .hero .content {
        animation: none;
    }

    .color {
        animation: none !important;
    }

    span.gradient {
        animation: none;
    }

    .machine-poster {
        position: absolute;
        display: block;
        right: 20%;
    }

    model-viewer {
        display: none;
    }

    .wrap .machine-poster {
        position: absolute;
        left: -7%;
    }

    .machine-item {
        transform: translateY(0) !important;
    }

    #colorContainer {
        transform: scale(1) !important;
    }

    #lp-pop .btn:hover::after {
        -webkit-transform: none;
        -moz-transform:  none;
        -ms-transform: none;
        transform: none;
    }

    @media (max-width: 996px) {
        .hero .machine-poster {
            left: 50%;
            right: auto;
            transform: translateX(-55%);
        }
    }

    @media (max-width: 768px) {
        .machine-poster {
            height: 325px;
            width: auto;
            left: 50%;
            right: auto;
            transform: translateX(-55%);
        }

        .wrap .machine-poster {
            left: 40%;
            bottom: 15%;
            transform: translateX(-35%);
        }
    }

    @media (max-width: 468px) {
        .wrap .machine-poster {
            left: 47%;
            bottom: 15%;
            transform: translateX(-35%);
        }
    }

    @media (max-width: 380px) {
        .wrap .machine-poster {
            left: 50%;
            bottom: 15%;
            transform: translateX(-35%);
        }
    }
}
</style>
<script>
window.onload = function() {

//data for text
const data = {
    'en': {
        'submenu': ['size', 'colour', 'cup sizes'],
        'h1': '<span class="gradient">VERTUO POP+</span><br /> SMALL MACHINE.<br/> BIG TASTE.',
        'h2s': ['Introducing our <span class="gradient">smallest</span> Vertuo  machine ever.', 'With <span class="gradient">many colours</span> to perfectly match your unique style.', 'Now you can brew <span class="gradient">five sizes</span> of coffee - hot or with ice.'],
        'CTA': 'shop vertuo pop+',
        'cups-name': ['40 ml<br />(Espresso)', '80 ml<br />(Double Espresso)', '150 ml<br />(Gran Lungo)', '230 ml<br />(Long Coffee)', '355 ml<br />(Alto)'],
    },
    'fr': {
        'submenu': ['format', 'couleur', 'tailles de tasse'],
        'h1': '<span class="gradient">VERTUO POP+</span><br/> PETITE MACHINE.<br/> GOÛT INOUBLIABLE.',
        'h2s': ['Voici la plus <span class="gradient">petite</span> de nos machines Vertuo.', "Avec un choix de <span class='gradient'>couleurs</span> qui s'adaptent à tous les styles.", 'Préparez du café chaud ou sur glace en <span class="gradient">cinq formats</span> différents'],
        'CTA': 'magasinez vertuo pop+',
        'cups-name': ['40 ml<br />(Espresso)', '80 ml<br />(Double Espresso)', '150 ml<br />(Gran Lungo)', '230 ml<br />(Grand café)', '355 ml<br />(Alto)'],
    }
};

const machinesData = [
    {
        'color': 'blue',
        'imgSrc': 'https://www.nespresso.com/static/de/solutions/b2c/assets/media/lp/vertuopop/img/BG220603_Vertuo_Pop_LandingPage_Section_3-5.png',
        'SKU': 'C+GDV6-CA-BL-NE',
        'arKey': 'vertuo-pop-d-range-blue-nespresso',
        'poster': '/ecom/medias/sys_master/public/26787710042142/poster-blue.png',
        'urlPath': '/order/machines/vertuo/vertuo-pop-plus-pacific-blue',
        'alt': {
            'en': 'Vertuo Pop + Pacific Blue coffee machine',
            'fr': 'Machine à café Vertuo Pop + Bleu Pacifique',
        },
        'name': {
            'en': 'Pacific Blue',
            'fr': 'Bleu Pacifique'
        },
        'hero': {
            'mobile': '',
            'desktop': 'https://www.nespresso.com/ecom/medias/sys_master/public/26769602707486/VertuoPop-PDPBackground-Desktop-Blue.jpg',
            'retina': '/ecom/medias/sys_master/public/26769601200158/VertuoPop-PDPBackground-Retina-Blue.jpg'
        }
    },
    {
        'name': 'aqua mint',
        'SKU': 'C+GCV6-CA-AQ-NE',
        'color': 'aqua',
        'imgSrc': 'https://www.nespresso.com/static/de/solutions/b2c/assets/media/lp/vertuopop/img/BG220603_Vertuo_Pop_LandingPage_Section_3-6.png',
        'arKey': 'vertuo-pop-c-range-aqua-nespresso',
        'poster': '/ecom/medias/sys_master/public/26787709222942/poster-aqua.png',
        'urlPath': '/order/machines/vertuo/vertuo-pop-plus-aquamint-nespresso-coffee-machine',
        'alt': {
            'en': 'Vertuo Pop + Aqua Mint coffee machine',
            'fr': 'Machine à café Vertuo Pop + Vert Menthe',
        },
        'name': {
            'en': 'Aqua Mint',
            'fr': 'Vert Menthe'
        },
        'hero': {
            'mobile': '/ecom/medias/sys_master/public/26648921178142/VertuoPop-PDPBackground-Mobile-Green.jpg',
            'desktop': 'https://www.nespresso.com/ecom/medias/sys_master/public/26648921079838/VertuoPop-PDPBackground-Desktop-Green.jpg',
            'retina': '/ecom/medias/sys_master/public/26648920981534/VertuoPop-PDPBackground-Retina-Green.jpg'
        }
    },
    {
        'name': 'spicy red',
        'SKU': 'C+GCV6-CA-RE-NE',
        'color': 'red',
        'imgSrc': 'https://www.nespresso.com/static/de/solutions/b2c/assets/media/lp/vertuopop/img/BG220603_Vertuo_Pop_LandingPage_Section_3-4.png',
        'arKey': 'vertuo-pop-c-range-red-nespresso',
        'poster': '/ecom/medias/sys_master/public/26787712925726/poster-red.png',
        'urlPath': '/order/machines/vertuo/vertuo-pop-plus-spicy-red',
        'alt': {
            'en': 'Vertuo Pop + Spicy Red coffee machine',
            'fr': 'Machine à café Vertuo Pop + Rouge Piment',
        },
        'name': {
            'en': 'Spicy Red',
            'fr': 'Rouge Piment'
        },
        'hero': {
            'mobile': '/ecom/medias/sys_master/public/26746666418206/VertuoPop-PDPBackground-Mobile-Red.jpg',
            'desktop': 'https://www.nespresso.com/ecom/medias/sys_master/public/26746663010334/VertuoPop-PDPBackground-Desktop-Red.jpg',
            'retina': '/ecom/medias/sys_master/public/26746662617118/VertuoPop-PDPBackground-Retina-Red.jpg'
        }
    },
    {
        'name': 'yellow mango',
        'SKU': 'C+GDV6-CA-YE-NE',
        'color': 'yellow',
        'imgSrc': 'https://www.nespresso.com/static/de/solutions/b2c/assets/media/lp/vertuopop/img/BG220603_Vertuo_Pop_LandingPage_Section_3-3.png',
        'arKey': 'vertuo-pop-d-range-yellow-nespresso',
        'poster': '/ecom/medias/sys_master/public/26787714400286/poster-yellow.png',
        'urlPath': '/order/machines/vertuo/vertuo-pop-plus-mango-yellow',
        'alt': {
            'en': 'Vertuo Pop + Mango Yellow coffee machine',
            'fr': 'Machine à café Vertuo Pop + Jaune Mangue',
        },
        'name': {
            'en': 'Mango Yellow',
            'fr': 'Jaune Mangue'
        },
        'hero': {
            'mobile': '',
            'desktop': 'https://i.postimg.cc/jj06Yd58/003.jpg',
            'retina': ''
        }
    },
    {
        'name': 'dark grey',
        'color': 'grey',
        'SKU': '',
        'imgSrc': 'https://www.nespresso.com/ecom/medias/sys_master/public/26787471523870/machine-range-dark-grey.png',
        'arKey': 'https://www.nespresso.com/shared_res/mos/free_html/ca/models/grey/published.glb/vertuo-pop-c-range-dark-grey-nespresso_model.glb',
        'poster': '/ecom/medias/sys_master/public/26851541319710/poster-grey.png',
        'alt': {
            'en': 'Vertuo Pop + Dark Gey coffee machine',
            'fr': 'Machine à café Vertuo Pop + Gris Foncé',
        },
        'name': {
            'en': 'Dark Gey',
            'fr': 'Gris foncé'
        },
        'hero': {
            'mobile': '/ecom/medias/sys_master/public/26780565307422/VertuoPop-PDPBackground-Mobile-grey.jpg',
            'desktop': 'https://www.nespresso.com/ecom/medias/sys_master/public/26780572024862/VertuoPop-PDPBackground-Desktop-Grey.jpg',
            'retina': '/ecom/medias/sys_master/public/26780568846366/VertuoPop-PDPBackground-Retina-grey.jpg'
        }
    },
    {
        'name': 'liquorice black',
        'SKU': 'C+GDV6-CA-BK-NE',
        'color': 'black',
        'imgSrc': 'https://www.nespresso.com/static/de/solutions/b2c/assets/media/lp/vertuopop/img/BG220603_Vertuo_Pop_LandingPage_Section_3-1.png',
        'arKey': 'vertuo-pop-d-range-black-nespresso',
        'poster': '/ecom/medias/sys_master/public/26851541155870/poster-black.png',
        'urlPath': '/order/machines/vertuo/vertuo-pop-plus-liquorice-black',
        'alt': {
            'en': 'Vertuo Pop + Black Liquor coffee machine',
            'fr': 'Machine à café Vertuo Pop + Noir réglisse',
        },
        'name': {
            'en': 'Liquorice Black',
            'fr': 'Noir réglisse'
        },
    },
];

const heroBgImgs = ['https://www.nespresso.com//ecom/medias/sys_master/public/26769602707486/VertuoPop-PDPBackground-Desktop-Blue.jpg', 'https://www.nespresso.com/ecom/medias/sys_master/public/26648921079838/VertuoPop-PDPBackground-Desktop-Green.jpg', 'https://www.nespresso.com/ecom/medias/sys_master/public/26746663010334/VertuoPop-PDPBackground-Desktop-Red.jpg', 'https://www.nespresso.com/ecom/medias/sys_master/public/26851541549086/yellow.jpg', 'https://www.nespresso.com/ecom/medias/sys_master/public/26780572024862/VertuoPop-PDPBackground-Desktop-Grey.jpg']

const currentLang = document.documentElement.lang;
const dataInCurrentLang = data[currentLang];


const body = document.querySelector('body');
const hero = document.querySelector('#lp-pop .hero');
const gifImg = document.querySelector('#lp-pop .cup-size-img');
const h1 = document.querySelector('#lp-pop h1')
const h2s = document.querySelectorAll('#lp-pop h2');
const modelViewerContainer = document.getElementById('custom3DViewerContainer')
const machineRangeSection = document.querySelector('#lp-pop .machine-range');
const cupSizeInfoEl = document.querySelector('#lp-pop .cup-size-info');
const custom3DViewer = document.getElementById('custom3DViewer');
const colorContainer = document.getElementById('colorContainer');
const shopNowBtn = document.querySelector('#lp-pop .shop-now-btn span');
const navLinks = document.querySelectorAll('#lp-pop nav a');
const heightInfos = document.querySelectorAll('#lp-pop .info');
const machineRange = document.querySelector('#lp-pop .machine-range');
const prevBtn = document.querySelector('#lp-pop .prev-btn');
const nextBtn = document.querySelector('#lp-pop .next-btn');
const shopBtn = document.querySelector('#lp-pop .shop-now-btn');
const milkPintImg = document.querySelector('.milk-pint');
const machinePosters = document.querySelectorAll('.machine-poster');
const comparaison = document.querySelector('.comparaison');

const isReduced = window.matchMedia(`(prefers-reduced-motion: reduce)`) === true || window.matchMedia(`(prefers-reduced-motion: reduce)`).matches === true;

const scrollPosition = window.scrollY;
const targetPosition = 700;

const cupSizeImgs = [
    {
        'img': '/shared_res/agility/next-components/assets/cup-size/vl_espresso.png',
        'alt': {
            'en': 'Espresso coffee',
            'fr': 'Café espresso',
        }
    }, 
    {
        'img':'/shared_res/agility/next-components/assets/cup-size/vl_double-espresso.png',
        'alt': {
            'en': 'Double espresso coffee',
            'fr': 'Café double espresso',
        }
    },
    {
        'img':'/shared_res/agility/next-components/assets/cup-size/vl_gran-lungo.png',
        'alt': {
            'en': 'Gran Lungo coffee',
            'fr': 'Café Gran Lungo',
        }
    },
    {
        'img':'/shared_res/agility/next-components/assets/cup-size/vl_mug.png',
        'alt': {
            'en': 'Long coffee',
            'fr': 'Café café'
        }
    },
    {
        'img':'/shared_res/agility/next-components/assets/cup-size/vl_cold-brew.png',
        'alt': {
            'en': 'Alto coffee Nespresso',
            'fr': 'Café Alto Nespresso'
        }
    } 
]

/**
 * Set opacity to 1 when heading is in viewport
*/
const observer = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.transform = "0";
            entry.target.style.opacity = "1";
        } else {
            entry.target.transform = "100px";
            entry.target.style.opacity = "0";
        }
    })
}, {
    threshold: 0.2
});

h2s.forEach(h2 => {
    observer.observe(h2);
});

/**
 *  Animation on each machine item in machine range section
*/
const machineRangeObserver = new IntersectionObserver((entries) => {
    const machineItems = document.querySelectorAll('.machine-item')
    let labelPrefix = 'Vertuo Pop + LP - Scroll -'
    
    if (window.innerWidth < 996) return;
    if (entries[0].isIntersecting) {
        machineItems.forEach(item => item.classList.add('animate-in'));
        machineItems.forEach(item => item.classList.remove('animate-out'));

    //     //tracking
        gtmDataObject.push(
        {
            event: 'customEvent', 
            eventRaisedBy: 'FreeHTML', 
            eventCategory: 'User Engagement', 
            eventAction: 'Scroll', 
            eventLabel: labelPrefix + 'End', 
            nonInteraction: '0'
    });
    } else {
        machineItems.forEach(item => item.classList.remove('animate-in'));
        machineItems.forEach(item => item.classList.add('animate-out'));
    }
}, {
    threshold: 0.3
});
  
machineRangeObserver.observe(machineRangeSection);

/**
 * CUP SECTION GIF
*/
let interval;

function displayCupSizeGif() {
    let index = 0;

    clearInterval(interval)
    interval = setInterval(() => {
    gifImg.src = `https://www.nespresso.com${cupSizeImgs[index]['img']}`;
    gifImg.alt = `${cupSizeImgs[index]['alt'][currentLang]}`

    cupSizeInfoEl.innerHTML = dataInCurrentLang['cups-name'][index];

    index = (index + 1) % 5;
}, 1500);
}

displayCupSizeGif();


//CUSTOM 3D VIEWER 
const colors = {
    blue: 'vertuo-pop-d-range-blue-nespresso',
    aqua: 'vertuo-pop-c-range-aqua-nespresso',
    red:  'vertuo-pop-c-range-red-nespresso',
    yellow: 'vertuo-pop-d-range-yellow-nespresso',
    grey: 'https://www.nespresso.com/shared_res/mos/free_html/ca/models/grey/published.glb/vertuo-pop-c-range-dark-grey-nespresso_model.glb',
    black: 'vertuo-pop-d-range-black-nespresso',
}

const colorKeys = Object.keys(colors);

for(let colorKey in colors) {
    colorContainer.innerHTML += '<li class="color ' + (colorKey == colorKeys[0] ? 'active' : '') +'" data-color="'+colorKey+'" data-tracking-label="Change Color - '+colorKey.charAt(0).toUpperCase() + colorKey.slice(1)+'"></li>';
}

let currentColor = colorKeys[0];
let arKey = colors[currentColor];

var viewerAttributes = {
    alt: 'Vertuo POP+ 3D Model',
    src: currentColor != 'grey' ? 'https://view.seekxr.com/nespresso/assets/models/'+arKey+'/published.glb' : arKey,
    poster: `https://www.nespresso.com${machinesData.map(({color, poster}) => color == currentColor ? poster : '').join('')}`,
    'data-color': currentColor,
    'shadow-intensity': '1',
    'touch-action' : "pan-y",
    'camera-orbit': '0 90deg',
    'data-color': 'blue'
}

const viewer3d = document.createElement('model-viewer')

for(let i in viewerAttributes) {
    viewer3d.setAttribute(i, viewerAttributes[i]);
}

modelViewerContainer.appendChild(viewer3d);

//handle click if not on color picker
document.addEventListener('click', (e) => {
    if (e.target.classList.contains('color')) return;

    h2s[1].innerHTML = dataInCurrentLang['h2s'][1];
});

// Change machine color when color from color picker is clicked
colorContainer.querySelectorAll('li').forEach((item, i) => {
    item.addEventListener('click', (e) => {
        currentColor = item.getAttribute('data-color');
        arKey = colors[currentColor];
        item.classList.add('active')
        colorContainer.querySelectorAll('.active').forEach(previousActive => {
            if(previousActive != item){
                previousActive.classList.remove('active');
            }
        })

        var viewerAttributes = {
            src: currentColor != 'grey' ? `https://view.seekxr.com/nespresso/assets/models/${arKey}/published.glb` : arKey,
            poster: `https://www.nespresso.com${machinesData.map(({color, poster}) => color == currentColor ? poster : '').join('')}`,
            dataColor: currentColor
        }

        for(let i in viewerAttributes) {
            viewer3d.setAttribute(i, viewerAttributes[i]);
        }

        //change text
        let markup = 'VERTUO POP+';
        body.setAttribute('data-color', currentColor);
        const machineData = machinesData.find(machine => machine.color == currentColor);

        markup += `<br /><span class="gradient ${currentColor}">${machineData['name'][currentLang]}<span>`;

        document.querySelector('h2:nth-child(2)').innerHTML = markup;
        document.querySelectorAll('h2 span.gradient').forEach(el => {
            el.className = `gradient ${currentColor}`;
        });

        //change poster for reduce motion
        machinePosters.forEach((poster, i) => {
            poster.src = `https://www.nespresso.com${machinesData.find(machine => machine.color == currentColor).poster}`;
        }),

        //change hero
        //update attr on hero
        hero.setAttribute('data-color', `${currentColor != 'black' ? currentColor : 'blue'}`);

        //change hero background
        hero.style.background = `no-repeat url("${i != 5 ?heroBgImgs[i] : heroBgImgs[0] }") center/cover`;


        //tracking
        handleTrackingWithGTM(e.target)

        //update data attribute on navLink
        viewer3d.setAttribute('data-color', currentColor);
    })
});

/**
 * OBSERVER ON HEADINGS
*/

const HeadingsObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        const currentHeading = entry.target.classList.value;
        let labelPrefix = 'Vertuo Pop + - Scroll -';
        
        if(currentHeading == 'first' && entry.isIntersecting) {
            body.setAttribute('data-heading', 'first');
            viewer3d.cameraOrbit = `0deg 90deg`;

            //tracking
            gtmDataObject.push(
                {
                    event: 'customEvent', 
                    eventRaisedBy: 'FreeHTML', 
                    eventCategory: 'User Engagement', 
                    eventAction: 'Scroll', 
                    eventLabel: labelPrefix + 'size', 
                    nonInteraction: '0'
            });
        } else if (currentHeading == 'second' && entry.isIntersecting) {
            body.setAttribute('data-heading', 'second');
            viewer3d.cameraOrbit = `-270deg -360deg`;

            //tracking
            gtmDataObject.push(
                {
                    event: 'customEvent', 
                    eventRaisedBy: 'FreeHTML', 
                    eventCategory: 'User Engagement', 
                    eventAction: 'Scroll', 
                    eventLabel: labelPrefix + 'colour', 
                    nonInteraction: '0'
            });
        } else if (currentHeading == 'third' && entry.isIntersecting) {
            body.setAttribute('data-heading', 'third');
            viewer3d.cameraOrbit = `-360deg 90deg`;

            //tracking
            gtmDataObject.push(
                {
                    event: 'customEvent', 
                    eventRaisedBy: 'FreeHTML', 
                    eventCategory: 'User Engagement', 
                    eventAction: 'Scroll', 
                    eventLabel: labelPrefix + 'cup sizes', 
                    nonInteraction: '0'
            });
        } 
    })
}, {
    threshold: .5
});

h2s.forEach(h2 => HeadingsObserver.observe(h2));

/**
 * DISPLAY MACHINE RANGE
*/
function displayMachineRange() {
    let markup = '';

    markup += machinesData.map(item => item).map(({name,imgSrc, SKU, alt}, i) =>  `<div class="machine-item">
            <p class="name">
                vertuo pop+ </br>
                ${name[currentLang]}
            </p>
            <p class="price">$169</p>
            ${i == 4 ? '' : `<div class="add-to-bag" data-button-size="small" data-product-id="${SKU}"></div>`}
            ${i == 4 && currentLang == 'en' ? '<p class="coming-soon">Coming Soon</p>' : ''}
            ${i == 4 && currentLang == 'fr' ? '<p class="coming-soon">Bientôt disponible</p>' : ''}
            <div class="visual">
                <img src="${imgSrc}" alt="${alt[currentLang]}">
            </div>
        </div>
    `).join('');

    machineRange.innerHTML = markup;
}

displayMachineRange();

if (window.mosaic) {
    mosaic.initializeAllFreeHTMLModules(machineRange);
}

addEventListener('scroll', function () {
    const currentScrollPosition = window.scrollY;
    const modelViewerContainerRect = modelViewerContainer.getBoundingClientRect();


    //desktop
    if (window.innerWidth > 996) {
        if (currentScrollPosition > 1400) return;
        const newPosition = Math.min(targetPosition, currentScrollPosition - scrollPosition);
        const degree = newPosition / targetPosition * 360;

        let top = window.pageYOffset / modelViewerContainerRect.bottom * 700;

        //set new camera orbit value on model viewer
        viewer3d.cameraOrbit = `${degree >= 360 ? 360 : degree}deg 90deg`;

        viewer3d.style.transform = `translateY(${top < 700 ? top : 700}px)`;
    } else {
        if (currentScrollPosition > 1000) return;
        let top = window.pageYOffset / modelViewerContainerRect.bottom * 800;
        const newPosition = Math.min(800, currentScrollPosition - scrollPosition);
        const degree = newPosition / targetPosition * 360;


        //set new camera orbit value on model viewer
        viewer3d.cameraOrbit = `${degree >= 360 ? 360 : degree}deg 90deg`;

        viewer3d.style.transform = `translate(-50vw, ${top < 800 ? top : 800}px)`;
    }
});

function handleMachineColor(color) {
    if (window.pageYOffset > 300) return;

    const machineData = machinesData.find(machine => machine.color == color)

    viewer3d.setAttribute('data-color', color);

    var viewerAttributes = {
        src: machineData.color != 'grey' ? 'https://view.seekxr.com/nespresso/assets/models/'+machineData.arKey+'/published.glb' : machineData.arKey,
        poster: `https://www.nespresso.com${machinesData.map(({color, poster}) => color == currentColor ? poster : '').join('')}`,
        dataColor: color
    }

    for(let i in viewerAttributes) {
        viewer3d.setAttribute(i, viewerAttributes[i]);
    }

    //update active color
    const colorsEl = document.querySelectorAll('.color')
    colorsEl.forEach(colorEl => {
        colorEl.classList.remove('active')
        if (colorEl.getAttribute('data-color') == color) {
            colorEl.classList.add('active')
        }
    })
}

function displayTextElements() {
    h1.innerHTML = dataInCurrentLang['h1'];
    h2s.forEach((h2, i) => h2.innerHTML = dataInCurrentLang['h2s'][i]);

    //submenu
    navLinks.forEach((link, i ) => link.innerHTML = `${dataInCurrentLang['submenu'][i]}`)

    //show now btn in submenu
    shopNowBtn.innerHTML = `${dataInCurrentLang['CTA']}`

    //height infos
    if (window.innerWidth > 996) {
        heightInfos[0].innerHTML = '265 MM / 10.4"';
        heightInfos[1].innerHTML = '250 MM / 10"';
    } else {
        heightInfos[0].innerHTML = '265 MM<br/>10.4"';
        heightInfos[1].innerHTML = '250 MM<br/>10"';
    }
}

displayTextElements();

let preloadedImages =   [];

function preloadImages(imgs) {
  for (let i = 0; i < imgs.length; i++) {
    const img = new Image();
    img.src = imgs[i];

    preloadedImages.push(img);
  }
}

preloadImages(['https://www.nespresso.com//ecom/medias/sys_master/public/26769602707486/VertuoPop-PDPBackground-Desktop-Blue.jpg', 'https://www.nespresso.com/ecom/medias/sys_master/public/26648921079838/VertuoPop-PDPBackground-Desktop-Green.jpg', 'https://www.nespresso.com/ecom/medias/sys_master/public/26746663010334/VertuoPop-PDPBackground-Desktop-Red.jpg', 'https://www.nespresso.com/ecom/medias/sys_master/public/26851541549086/yellow.jpg', 'https://www.nespresso.com/ecom/medias/sys_master/public/26780572024862/VertuoPop-PDPBackground-Desktop-Grey.jpg','https://www.nespresso.com/ecom/medias/sys_master/public/26787710042142/poster-blue.png', 'https://www.nespresso.com/ecom/medias/sys_master/public/26787709222942/poster-aqua.png', 'https://www.nespresso.com/ecom/medias/sys_master/public/26787712925726/poster-red.png', 'https://www.nespresso.com/ecom/medias/sys_master/public/26787714400286/poster-yellow.png', 'https://www.nespresso.com/ecom/medias/sys_master/public/26851541319710/poster-grey.png', 'https://www.nespresso.com/ecom/medias/sys_master/public/26851541155870/poster-black.png']);

// TRACKING
function handleTrackingWithGTM(trackedElem) {
    let labelPrefix = 'Vertuo Pop + - ';
    const trackingLabel = trackedElem.getAttribute('data-tracking-label');

    gtmDataObject.push(
        {
            event: 'customEvent', 
            eventRaisedBy: 'FreeHTML', 
            eventCategory: 'User Engagement', 
            eventAction: 'Click', 
            eventLabel: labelPrefix + trackingLabel, 
            nonInteraction: '0'
    });
}

navLinks.forEach(navLink => navLink.addEventListener('click', (e) => handleTrackingWithGTM(e.target)));

//handle click on machine and redirect to page and add tracking
function redirectToMachinePDP(e) {
    if (e.target.classList.contains('color')) return;

    let labelPrefix = 'Vertuo Pop + - Go to PDP - ';

    const color = viewer3d.getAttribute('datacolor');
    const machine = machinesData.find(machine => machine.color == color)

    console.log(machinesData.find((machine) => machine.color == color).urlPath)
    //redirect
    if (machine.urlPath) window.open(`https://www.nespresso.com/ca/${currentLang}${machinesData.find((machine) => machine.color == color).urlPath}`, '_blank');

    //tracking
    gtmDataObject.push(
        {
            event: 'customEvent', 
            eventRaisedBy: 'FreeHTML', 
            eventCategory: 'User Engagement', 
            eventAction: 'Click', 
            eventLabel: labelPrefix + color, 
            nonInteraction: '0'
    });

}

viewer3d.addEventListener('click', redirectToMachinePDP);
comparaison.addEventListener('click', (e) => redirectToMachinePDP(e));

// Carousel on mobile for machine range section
let yoffset = 0;

function moveMachineRange(direction) {
    //desktop
    if (direction == 'left') yoffset += 150;
    if (direction == 'right') yoffset -= 150;

    let maxOffset = `${window.innerWidth - 900}`;
    console.log(maxOffset)

    //handle prev btn visibility
    if (yoffset < 0) {
        prevBtn.style.display = 'block';
    } else {
        prevBtn.style.display = 'none';
    }

    //handle next btn visibility
    if (yoffset <= maxOffset) {
        nextBtn.style.display = 'none';
    } else {
        nextBtn.style.display = 'block';
    }

    machineRange.style.transform = `translateX(${yoffset}px)`;
}

prevBtn.addEventListener('click', () => moveMachineRange('left'))
nextBtn.addEventListener('click', () => moveMachineRange('right'))


//redirect vers pdp of machine current color
shopBtn.addEventListener('click', () => {
    const color = viewer3d.getAttribute('data-color');
    const machine = machinesData.find(machine => machine.color == color)

    //redirect
    if (machine.urlPath) window.open(`https://www.nespresso.com/ca/${currentLang}${machine.urlPath ? machine.urlPath : '/ca/en/order/machines/vertuo/vertuo-pop-plus-pacific-blue'}`, '_blank');;

    gtmDataObject.push(
        {
            event: 'customEvent', 
            eventRaisedBy: 'FreeHTML', 
            eventCategory: 'User Engagement', 
            eventAction: 'Click', 
            eventLabel: 'Vertuo Pop+ LP - Menu - Shop', 
            nonInteraction: '0'
    });
})

//nav links
navLinks.forEach((link, i) => link.addEventListener('click', (e) => {
    e.preventDefault();

    let y = '';

    if (window.innerWidth > 768) {
        y =  h2s[i].getBoundingClientRect().top - (window.innerHeight / 2 || document.documentElement.clientHeight / 2)  + window.scrollY;
    } else {
        y =  h2s[i].getBoundingClientRect().top + window.scrollY;
    }

    if (window.innerWidth > 996) {
        viewer3d.style.transform = `translateY(700px)`;
    } else {
        viewer3d.style.transform = `translate(-50vw, 800px)`;
    }

    window.scroll({
        top: y,
      });
      
}));

function displayMilkPint () {
    //retina
    if (window.innerWidth > 1200) {
        //retina
        milkPintImg.src = "https://www.nespresso.com/ecom/medias/sys_master/public/26787474440222/milk-pint-retina.png";
    } else if (window.innerWidth > 996) {
        //desktop
        milkPintImg.src = "https://www.nespresso.com/ecom/medias/sys_master/public/26787474440222/milk-pint-desktop.png";
    } else { 
        //mobile
        milkPintImg.src = "https://www.nespresso.com/ecom/medias/sys_master/public/26787474440222/milk-pint-mobile.png" ;
    }

    milkPintImg.alt = `${dataInCurrentLang == 'en' ? 'Nespresso coffee with milk recipe' : 'Café avec du lait Nespresso'}`
}

displayMilkPint();

/**
 * CHANGE HERO BG COLOR AND MACHINE COLOR
*/

function changeHeroImage() {
    let index = 0;

    if (isReduced) return;

    let heroInterval = setInterval(() => {
        handleMachineColor(machinesData[index].color);
    }, 3000);

    viewer3d.addEventListener('load', () => {
        //update attr on hero
        hero.setAttribute('data-color', `${machinesData[index].color}`);
        //change hero background
        hero.style.background = `no-repeat url("${heroBgImgs[index]}") center/cover`;
		
		//update index
        index = (index + 1) % 5;
    })
}

changeHeroImage();

}
</script>